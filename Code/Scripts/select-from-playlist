#!/bin/bash

res="$(xwininfo -root | grep Height | sed -E 's/[[:space:]]+//g' | cut -d: -f2)"
lines=$(((7*res - 72)/156))

current=$(mpc -f "%position%ğŸ’Œ%title%ğŸ’Œ%artist%ğŸ’Œ%album%" current)
queued=$(mpc -f "%position%ğŸ’Œ%title%ğŸ’Œ%artist%ğŸ’Œ%album%" queued)

playlist="$(mpc -f "##ğŸ’Œ%position%ğŸ’Œ%title%ğŸ’Œ%artist%ğŸ’Œ%album%" playlist | sed -E "s/#ğŸ’Œ($current)/>ğŸ’Œ\1/g;s/#ğŸ’Œ($queued)/*ğŸ’Œ\1/g;s/#ğŸ’Œ/ ğŸ’Œ/g" | sed 's/,/^/g;s/ğŸ’Œ/,/g')"

playlistid="$(echo -e "?,ID,Title,Artist,Album\n$playlist" \
                   | csv-format \
                   | tr '^' ',' \
                   | dmenu -l $lines -i -r -p "Pick song: " \
                   | sed 's/â•‘/|/g' \
                   | cut -d'|' -f3)"

[[ "$playlistid" =~ [[:digit:]]+ ]] || exit 1


mpc play $playlistid
