#!/bin/bash

selectPlayer(){
    local current="$(mpris-player)"
    local currentInd="$(mpris-status | grep "$current" --line-number | cut -d: -f1)"
    local ind="$((currentInd - 1))"
    echo -e "$(mpris-status)" \
        | tr ',|' '`,' \
        | sed -E "s/^($current)/â¡ \1/g"\
        | csv-format \
        | tr '`' ',' \
        | sed -E 's/ğŸª›/|/g;s/â•‘ Playing â•‘/â•‘ â–¶ â•‘/g;s/â•‘ Paused [ ]?â•‘/â•‘ â¸ â•‘/g;s/â•‘ Status [ ]?â•‘/â•‘ â¯ â•‘/g' \
        | sed -E 's/[â•šâ•â•©â•â• â•¬â•£â•”â•¦â•—]//g;/^$/d;s/â•‘/â€‹/g'\
        | rofi -dmenu \
               -a "$ind" \
               -p "Player" \
               -mesg "Choose which player will be active."\
        | sed 's/â€‹/|/g;s/^|//g;s/|$//g' \
        | sed -E 's/[[:space:]]+/ /g;s/(^|[|]) /\1/g;s/ ($|[|])/\1/g' \
        | cut -d'|' -f1\
        | sed 's/^â¡ //g'
}

selected="$(selectPlayer)"

if [ -n "$selected" ] && [ "$selected" != "Player" ]
then
    echo "$selected" | tee "$XDG_CACHE_HOME/mpris-player"
fi
